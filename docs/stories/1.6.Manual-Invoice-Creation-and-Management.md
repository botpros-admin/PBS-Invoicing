# Story 1.6: Manual Invoice Creation and Management

## Status
Done

## Story
**As a** Billing Company user,
**I want** a user-friendly interface to manually create, edit, and manage invoices with multiple patients and line items,
**so that** I can handle one-off billing scenarios.

## Acceptance Criteria
1.  The "Create Invoice" page is updated to support the new multi-patient data model.
2.  Users can add multiple patients to a single invoice.
3.  For each patient, users can add multiple line items with CPT codes, dates of service, and prices.
4.  The system uses the dynamic pricing engine to automatically populate the price for each line item.
5.  The UI is intuitive and guides the user through the process of creating a complex invoice.
6.  Existing invoices can be edited using the same interface.

## Tasks / Subtasks
- [x] **Task 1: Refactor Create/Edit Invoice UI** (AC: #1, #2, #3, #5, #6)
    - [x] Update the `CreateInvoice.tsx` component to handle the new invoice data structure.
    - [x] Implement a UI that allows users to add/remove patients from an invoice.
    - [x] For each patient, implement a UI to add/remove line items.
    - [x] Ensure the form is well-structured and easy to navigate.
- [x] **Task 2: Integrate Dynamic Pricing** (AC: #4)
    - [x] When a user enters a CPT code for a line item, call the `pricing.service.ts` to get the correct price.
    - [x] Automatically populate the price field with the returned value.
- [x] **Task 3: Update API Calls**
    - [x] Modify the `createInvoice` and `updateInvoice` calls in `CreateInvoice.tsx` to send the data in the new format.
- [x] **Task 4: Documentation and Rollback**
    - [x] Update any relevant documentation to reflect the new invoice creation process.
    - [x] Add rollback procedures to `docs/ROLLBACK_PROCEDURES.md`.

## Dev Notes
This story involves significant changes to one of the core UI components of the application. The developer should focus on creating a highly usable and intuitive interface that can handle the complexity of multi-patient invoices.

### Testing
-   Manually test the entire invoice creation and editing workflow with various scenarios (single patient, multiple patients, custom pricing, default pricing).
-   Write frontend tests for the `CreateInvoice.tsx` component to ensure it correctly handles the new data model and user interactions.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- | --- |
| 2025-08-01 | 1.0 | Initial draft | Bob (Scrum Master) |
| 2025-08-01 | 1.1 | Completed UI refactoring for multi-patient invoices. | James (Developer) |
| 2025-08-01 | 1.2 | Final QA review passed. | Quinn (QA) |
